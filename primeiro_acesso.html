<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Primeiro Acesso</title>
  <style>
    :root{
      --bg:#f8fdf9;
      --card:#ffffff;
      --text:#1a472a;
      --muted:#5d7a6d;
      --primary:#10b981;
      --primary-600:#0da271;
      --primary-700:#0b8c61;
      --border:#d1fae5;
      --ok-bg:#ecfdf5; --ok:#065f46; --ok-br:#a7f3d0;
      --err-bg:#fef2f2; --err:#991b1b; --err-br:#fecaca;
    }
    *{ box-sizing:border-box }
    body{
      margin:0;
      font-family: 'Segoe UI', system-ui, -apple-system, Roboto, Arial, sans-serif;
      background: var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:var(--text);
    }
    .container{
      width:100%;
      max-width:440px;
      background:var(--card);
      border-radius:20px;
      box-shadow:0 15px 35px rgba(16, 185, 129, 0.1), 0 5px 15px rgba(0, 0, 0, 0.05);
      padding:36px 32px;
      border:1px solid var(--border);
    }

    .title-container{ text-align:center; margin-bottom:28px; }
    .title-container i{
      font-size: 32px; color: var(--primary);
      margin-bottom: 12px; display:block;
    }
    h2{
      text-align:center;
      margin:0 0 8px;
      color:#0f5132;
      font-size:28px;
      font-weight:800;
      position: relative;
      padding-bottom: 12px;
    }
    h2::after{
      content:'';
      position:absolute;
      bottom:0; left:50%;
      transform:translateX(-50%);
      width:60px; height:3px;
      background: linear-gradient(90deg, var(--primary), var(--primary-600));
      border-radius: 2px;
    }
    .subtitle{ color:var(--muted); font-size:15px; margin:8px 0 0; }

    label{
      display:block;
      margin:14px 0 8px;
      color:#1a472a;
      font-size:14px;
      font-weight:700;
    }
    input{
      width:100%;
      padding:14px 16px;
      margin-bottom:18px;
      border:2px solid var(--border);
      border-radius:12px;
      outline:none;
      background:#f8fdf9;
      color:var(--text);
      transition:all 0.25s ease;
      font-size:16px;
    }
    input:focus{
      border-color:var(--primary);
      background:#fff;
      box-shadow:0 0 0 4px rgba(16, 185, 129, 0.15);
      transform: translateY(-1px);
    }

    button{
      width:100%;
      padding:16px;
      margin:8px 0 16px;
      background:linear-gradient(135deg, var(--primary), var(--primary-600));
      color:#fff;
      border:none;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      font-size:16px;
      transition:all 0.25s ease;
      box-shadow:0 10px 25px rgba(16, 185, 129, 0.3);
    }
    button:hover{
      background:linear-gradient(135deg, var(--primary-600), var(--primary-700));
      transform: translateY(-2px);
    }
    button:disabled{
      opacity:.7;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .error-message{
      display:none;
      margin:-8px 0 16px 0;
      padding:10px 12px;
      background:var(--err-bg);
      border-radius:10px;
      border:2px solid var(--err-br);
      color:var(--err);
      font-size:14px;
      font-weight:700;
    }
    .success-message{
      display:none;
      margin:12px 0 20px;
      padding:12px 14px;
      background:var(--ok-bg);
      border-radius:12px;
      border:2px solid var(--ok-br);
      color:var(--ok);
      font-weight:700;
      text-align:center;
    }

    .home-button{
      display:block;
      width:100%;
      padding:14px;
      background:#f0fdf9;
      color:#0b8c61;
      text-align:center;
      text-decoration:none;
      border:2px solid #d1fae5;
      border-radius:12px;
      font-weight:800;
      font-size:16px;
      transition:all 0.25s ease;
      margin-top:6px;
    }
    .home-button:hover{
      background:#e5f7ef;
      border-color:var(--primary);
      color:var(--primary-700);
      transform: translateY(-2px);
    }

    .input-icon{ position:relative; }
    .input-icon i{
      position:absolute;
      left:16px;
      top:46px;
      color: var(--muted);
    }
    .input-icon input{ padding-left:45px; }

  </style>
</head>
<body>
  <div class="container">
    <div class="title-container">
      <i class="fas fa-user-plus"></i>
      <h2>Primeiro Acesso</h2>
      <p class="subtitle">Crie sua conta para acessar o sistema</p>
    </div>

    <form id="registrationForm" novalidate>
      <div class="input-icon">
        <i class="fas fa-user"></i>
        <label for="fullName">Nome completo</label>
        <input type="text" id="fullName" placeholder="Digite seu nome completo" required>
      </div>

      <div class="input-icon">
        <i class="fas fa-envelope"></i>
        <label for="email">E-mail</label>
        <input type="email" id="email" placeholder="seu@email.com" required>
      </div>

      <div class="input-icon">
        <i class="fas fa-lock"></i>
        <label for="password">Senha</label>
        <input type="password" id="password" placeholder="••••••••" required>
      </div>

      <div class="input-icon">
        <i class="fas fa-lock"></i>
        <label for="confirmPassword">Confirmar senha</label>
        <input type="password" id="confirmPassword" placeholder="••••••••" required>
      </div>

      <div class="error-message" id="msgErr"></div>
      <div class="success-message" id="msgOk">Cadastro enviado! Aguarde liberação. Redirecionando…</div>

      <button id="btnSubmit" type="submit">
        <i class="fas fa-check-circle"></i> Finalizar Cadastro
      </button>
    </form>

    <a href="index.html" class="home-button">
      <i class="fas fa-arrow-left"></i> Voltar para Login
    </a>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // FontAwesome via CSS import (simples)
    const style = document.createElement('style');
    style.textContent = `@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');`;
    document.head.appendChild(style);

    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzrhlcJXYD_V19BC1scpM5eGUUo3SOyc_k4scIcd4vg4Ii3szlWqjFYsyjwi4B9SkpU0w/exec';

    const form = document.getElementById('registrationForm');
    const btn = document.getElementById('btnSubmit');

    const fullNameEl = document.getElementById('fullName');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const pass2El = document.getElementById('confirmPassword');

    const msgErr = document.getElementById('msgErr');
    const msgOk = document.getElementById('msgOk');

    function showErr(t){ msgErr.textContent = t; msgErr.style.display = 'block'; msgOk.style.display='none'; }
    function showOk(){ msgOk.style.display = 'block'; msgErr.style.display='none'; }
    function clearMsgs(){ msgErr.style.display='none'; msgOk.style.display='none'; }

    function basicValidate(){
      const nome = fullNameEl.value.trim();
      const email = emailEl.value.trim().toLowerCase();
      const senha = passEl.value;

      if(!nome) return { ok:false, msg:'Informe o nome completo.' };
      if(!email) return { ok:false, msg:'Informe o e-mail.' };
      if(!email.includes('@')) return { ok:false, msg:'E-mail inválido.' };
      if(!senha) return { ok:false, msg:'Informe a senha.' };
      if(senha.length < 4) return { ok:false, msg:'Senha muito curta (mínimo 4).' };
      if(passEl.value !== pass2El.value) return { ok:false, msg:'As senhas não coincidem.' };

      return { ok:true, nome, email, senha };
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMsgs();

      const v = basicValidate();
      if(!v.ok){ showErr(v.msg); return; }

      btn.disabled = true;
      const old = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';

      try{
        const body = new URLSearchParams({
          action: 'register',
          nome: v.nome,
          email: v.email,
          senha: v.senha
        });

        const resp = await fetch(WEBAPP_URL, { method:'POST', body });
        const text = await resp.text();

        let json=null;
        try{ json = JSON.parse(text); }catch{}

        if(!resp.ok) throw new Error(json?.mensagem || text || ('HTTP ' + resp.status));
        if(!json || json.status !== 'OK') throw new Error(json?.mensagem || 'Erro ao cadastrar.');

        // opcional: pré-preencher login depois
        localStorage.setItem('PAVI_FAST_LAST_EMAIL', v.email);

        showOk();
        form.reset();

        // ✅ volta pro login correto
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1800);

      }catch(err){
        showErr('Erro: ' + (err.message || err));
      }finally{
        btn.disabled = false;
        btn.innerHTML = old;
      }
    });
  });
  </script>
</body>
</html>
